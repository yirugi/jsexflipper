window.__tnt||(window.__tnt={}),__tnt.notifyPanel=function(){return function(t){var e,n,o,a,r,c,l={},s=!1,d={},u=function(){if(o.style.display="block",localStorage.getItem("tnt_notifications"))for(var t=JSON.parse(localStorage.getItem("tnt_notifications")),e=t.length-1;e>=0;e--)l.notes.unshift(t[e]),v(t[e])},f=function(){localStorage.getItem("tnt_notification_subscriptions")&&(d=JSON.parse(localStorage.getItem("tnt_notification_subscriptions")),Object.keys(d).forEach(function(t){if(1==d[t]&&document.getElementById("topic-"+t)){var e=document.getElementById("topic-"+t);e.checked=!0,e.parentNode.querySelector(".sr-only").innerText="Unsubscribe"}}))},p=function(){var t=document.querySelectorAll('[data-control="notification"]');for(i=0;i<t.length;i++)t[i].style.display="block",t[i].addEventListener("click",function(){l.toggle()})},g=function(){for(var t=document.querySelectorAll('[data-control="notification"][data-tooltip]'),e=0;e<t.length;e++)!function(e){var n=localStorage.getItem("tnt_notification_tooltip_"+t[e].dataset.id);if(null===n||t[e].dataset.tooltipDisplayAgain&&Date.now()-n>60*parseFloat(t[e].dataset.tooltipDisplayAgain)*60*1e3){var i;i=t[e].classList.contains("stuck")?t[e]:t[e].querySelector(".nav li a"),window.setTimeout(function(){var n={trigger:"manual",placement:t[e].dataset.tooltipPlacement,html:!0,content:'<div class="notification-tooltip">'+t[e].dataset.tooltip+"</div>"};"right"===t[e].dataset.tooltipPlacement&&(n.container="#"+t[e].id),$(i).popover(n),$(i).popover("show")},500);var o=function(){$(i).popover("hide"),document.body.removeEventListener("click",o)};document.body.addEventListener("click",o),localStorage.setItem("tnt_notification_tooltip_"+t[e].dataset.id,Date.now())}}(e)},y=function(){if(!1===l.isOpen()){var t=document.querySelectorAll('[data-control="notification"]');for(i=0;i<t.length;i++)t[i].classList.add("ring"),t[i].querySelector(".badge-dot").style.display="block"}},m=function(){var t=document.querySelectorAll('[data-control="notification"]');for(i=0;i<t.length;i++)t[i].classList.remove("ring"),t[i].querySelector(".badge-dot").style.display="none"},h=function(){document.addEventListener("notification-popup-removed",function(t){l.addNote(t.detail.note),y()}),e.querySelector(".notify-panel-close").addEventListener("click",function(){l.toggle()}),n.addEventListener("click",function(t){if(t.target&&t.target.closest(".notification-item-dismiss")){var e=t.target.closest(".notification-item"),n=Array.prototype.indexOf.call(e.parentNode.children,e);l.removeNote(n)}}),document.getElementById("notify-panel-settings").addEventListener("change",function(t){t.target.classList.contains("switch-input")&&(t.target.disabled=!0,a.style.opacity=0,t.target.checked?TNCMS.Messaging.subscribe(t.target.dataset.topic).then(function(){d[t.target.dataset.topic]=1,localStorage.setItem("tnt_notification_subscriptions",JSON.stringify(d)),t.target.disabled=!1,t.target.checked=!0,t.target.parentNode.querySelector(".sr-only").innerText="Unsubscribe"},function(e){console.error(e),t.target.disabled=!1,t.target.checked=!1,t.target.parentNode.querySelector(".sr-only").innerText="Subscribe",a.innerHTML="Unable to subscribe to topic. Please try again later.",a.style.display="block",a.style.opacity=1}):TNCMS.Messaging.unsubscribe(t.target.dataset.topic).then(function(){d[t.target.dataset.topic]=0,localStorage.setItem("tnt_notification_subscriptions",JSON.stringify(d)),t.target.disabled=!1,t.target.checked=!1,t.target.parentNode.querySelector(".sr-only").innerText="Subscribe"},function(e){console.error(e),t.target.disabled=!1,t.target.checked=!0,t.target.parentNode.querySelector(".sr-only").innerText="Unsubscribe",a.innerHTML="Unable to unsubscribe from topic. Please try again later.",a.style.display="block",a.style.opacity=1}))},!1),a.addEventListener("transitionend",function(t){t.stopPropagation(),"opacity"===t.propertyName&&"0"===t.target.style.opacity&&(t.target.style.display="none",t.target.style.innerHTML="")})},v=function(t){var e=N(t);n.insertBefore(e,n.firstChild),n.children.length>0&&(o.style.display="none")},b=function(t){n.removeChild(n.children[t]),0===n.children.length&&(o.style.display="block")},S=function(){localStorage.setItem("tnt_notifications",JSON.stringify(l.notes))},_=function(t){if("content"in document.createElement("template"))return t.content;var e=document.createDocumentFragment(),n=t.childNodes;for(i=0;i<n.length;i++)e.appendChild(n[i].cloneNode(!0));return e},N=function(t){var e=_(c).cloneNode(!0);if(e.querySelector(".notification-item-header").textContent=t.title,t.url){var n=e.querySelector(".notification-item a");n.href=t.url,r&&(n.href+="?",Object.keys(r).forEach(function(t,e){0!=e&&(n.href+="&"),n.href+=t+"="+r[t]}))}else{var i=e.querySelector(".notification-item a");i.parentNode.removeChild(i)}if(t.image)e.querySelector(".notification-item-image img").src=t.image;else{var o=e.querySelector(".notification-item-image");o.parentNode.removeChild(o)}var a=e.querySelector(".notification-item-summary"),l=t.message;if(l)a.innerHTML=l;else{var s=e.querySelector(".notification-item-summary");s.parentNode.removeChild(s)}return document.importNode(e,!0)};return l.notes=[],l.init=function(t){e=document.getElementById(t.panel_id),n=e.querySelector(".notify-panel-content-items"),o=e.querySelector(".notify-panel-content-no-items"),a=e.querySelector(".notify-panel-settings-error"),c=e.querySelector("template"),r=t.utm,e.classList.contains("notify-panel")||e.classList.add("notify-panel"),u(),f(),p(),g(),h()},l.open=function(){return e.classList.add("notify-panel-visible"),s=!0,0===n.children.length&&$("#notification-panel .notify-panel-nav ul li:nth-child(2) a").tab("show"),m(),this},l.close=function(){return e.classList.remove("notify-panel-visible"),s=!1,this},l.toggle=function(){return this.isOpen()?this.close():this.open()},l.isOpen=function(){return s},l.addNote=function(t){return this.notes.unshift(t),v(t),S(),this},l.removeNote=function(t){return this.notes.splice(t,1),b(t),S(),this},l.init(t),l}}(),function(){if(!("serviceWorker"in navigator&&"PushManager"in window))throw new Error("The Push API and/or Service workers are disabled or not supported");var t={panel_id:"notification-panel",utm:{utm_source:"BLOX Broadcast",utm_campaign:"Push Notification",utm_medium:"referral",utm_content:"in-panel notification"}};"loading"==document.readyState?document.addEventListener("DOMContentLoaded",function(){__tnt.notificationPanel=new __tnt.notifyPanel(t)}):__tnt.notificationPanel=new __tnt.notifyPanel(t)}();
//# sourceMappingURL=tnt.notify.panel.d7dc4795339f38cc067ead9f2f5ef1fb.js.map