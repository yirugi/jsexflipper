(window.webpackJsonpnxtBundle=window.webpackJsonpnxtBundle||[]).push([["Auth0UniversalLoginAuthSystem"],{25:function(t,e,n){"use strict";var o=n(31),r=n(13),i=n(155),s=n(16),u=n(32),c=n(265),l=n(281),h=n(2),p=n(263),a=new(function(){function t(){c.a.get(h.e.DisqusToken,{expandKey:!1,useRootDomain:!0}),c.a.get(h.e.DisqusDemos,{expandKey:!1,useRootDomain:!0})}return t.prototype.integrate=function(){var i=s.a.getUserData(),a={id:i.CustomerRegistrationId,username:i.DisplayName?i.DisplayName:i.Email.split("@")[0],email:i.Email};l.a.post("user/integrateDisqus",a).then(function(t){var e=a.username.split(" "),n=e[0],o="";2==e.length?o=e[1]:2<e.length&&(e.shift(),o=e.join(" "));var r={nameFirst:n,nameLast:o,age:0,gend:0,userId:i.CustomerRegistrationId};c.a.set(h.e.DisqusToken,t,{expandKey:!1,daysOfLife:u.a.get(p.a.UserAuthenticationTime),useRootDomain:!0}),c.a.set(h.e.DisqusDemos,r,{expandKey:!1,daysOfLife:u.a.get(p.a.UserAuthenticationTime),useRootDomain:!0})})},t.prototype.clearCookie=function(){c.a.delete(h.e.DisqusToken,{expandKey:!1,useRootDomain:!0}),c.a.delete(h.e.DisqusDemos,{expandKey:!1,useRootDomain:!0})},t}()),m=n(279),f=n(250),g=n(256),d=n(218),y=n(257),A=n(280),v=n(26),P=n(15),D=n(0),S=n(24);n.d(e,"a",function(){return U});var U=function(){function t(){}return t.prototype.HasActiveSession=function(){return Promise.resolve(!1)},t.prototype.successLogin=function(){(g.a.dispatch(d.a.LoginSuccess,{MG2AccountData:s.a.getUserData(),AuthProfile:s.a.getAuthProfile(),AuthSystem:this.name}),u.a.isIntegrateDisqus()&&a.integrate(),r.a.getActivationProcess())?y.a.get(p.a.ActivationInstance).processActivateStep():this.afterSuccessLogin()},t.prototype.afterSuccessLogin=function(){g.a.dispatch(i.g.ApplicationReload,i.k.Login)},t.prototype.successRegistration=function(){(g.a.dispatch(d.a.RegistrationSuccess,{MG2AccountData:s.a.getUserData(),AuthProfile:s.a.getAuthProfile(),AuthSystem:this.name}),u.a.isIntegrateDisqus()&&a.integrate(),r.a.getActivationProcess())?(g.a.dispatch(d.a.ActivationAccountCreated,{Email:this.authProfile.Email,DisplayName:this.authProfile.FullName}),y.a.get(p.a.ActivationInstance).process()):this.afterSuccessRegistration()},t.prototype.afterSuccessRegistration=function(){r.a.stopRegistrationProcess(),g.a.dispatch(i.g.ApplicationReload,i.k.Login)},t.prototype.failLogin=function(t){g.a.dispatch(d.a.LoginError,t.ErrorMessage)},t.prototype.showLoginForm=function(t){},t.prototype.showRegisterForm=function(t){},t.prototype.setAuthEventsListeners=function(){},t.prototype.login=function(t,e,n){return Promise.resolve()},t.prototype.getUserData=function(n){var o=this;return n.UserId?S.a.getUserData(n.UserId,n.IdType).then(function(t){A.a.log(o.name,"getUserData",t);var e=o.createUserDataFrom(n,t);return Promise.resolve(e)}).catch(function(t){A.a.log(o.name,"getDefaultUserData",t);var e=o.createUserDataFrom(n);return Promise.resolve(e)}):Promise.resolve(this.getDefaultUserData())},t.prototype.getDefaultUserData=function(t){return A.a.log(this.name,"getDefaultUserData"),new o.a({UserState:t?i.q.LoggedIn:i.q.NotLoggedIn,AuthSystem:this.name,AuthSystemId:this.id,ZipCodes:[m.a.getZipCode()]})},t.prototype.getAuthProfile=function(){return Promise.resolve(this.authProfile)},t.prototype.logout=function(){a.clearCookie()},t.prototype.processLinks=function(t){var n=this,e=Object(v.g)(t);Object(D.each)(e,function(t){var e=P.a.attr(t,"href")||"";(e=f.a.getUrlWithQueryParams(t,e))&&"#"!==e&&n.processLink(t,e)})},t.prototype.processLink=function(t,e){P.a.attr(t,{href:f.a.getUrlWithReturnParam(e)})},t.prototype.clearStorage=function(){},t.prototype.sendForgotPasswordRequest=function(t,e){throw"Not implemented"},t.prototype.useMg2LoginTemplate=function(){return!1},t.prototype.hasPartialMg2AuthCookies=function(){return!1},t.prototype.createUserDataFrom=function(t,e){var n;return(n=e?new o.a(e):new o.a(t)).UserState=null,n.updateAuthProfileData(t),n.setAuthSystemInfo(this.id,this.name),n},t.prototype.authSystemNotFound=function(){A.a.warn(this.constructor.name,"No global object found!")},t.prototype.syncUser=function(t){var e={CustomRegId:s.a.getCustomerRegistrationId()};return s.a.syncUser(e,t).catch(function(){return Promise.resolve()})},t}()},252:function(t,e,n){"use strict";n.r(e);var o=n(244),r=n(25),i=n(32),a=n(280),s=n(264),u=n(26),c=n(256),l=n(218),h=n(257),p=n(263),m=n(115),f=n(155),g=n(13),d=n(2),y=n(265),A=function(){function t(){}return t.prototype.getAuth0AccountId=function(){var t=this.getGetterOptions();return y.a.get(d.b.Auth0AccountId,t)},t.prototype.setAuth0AccountId=function(t,e){var n=this.getSetterOptions(e);y.a.set(d.b.Auth0AccountId,t,n)},t.prototype.deleteAuth0AccountId=function(){y.a.delete(d.b.Auth0AccountId,this.getGetterOptions())},t.prototype.getSetterOptions=function(t){return{daysOfLife:t,expandKey:!1,useRootDomain:!0}},t.prototype.getGetterOptions=function(){return{expandKey:!1,useRootDomain:!0}},t}(),v=n(16),P=n(196);n.d(e,"Auth0UniversalLoginAuthSystem",function(){return U});var D,S=(D=function(t,e){return(D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}D(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),U=function(n){function t(){var t=n.call(this)||this;t.name="Auth0UniversalLogin",t.id=f.a.Auth0UniversalLogin,t.knownErrMessages={invalidState:"Invalid state"},t.urlParams={returnUrl:{name:"returnUrl",values:void 0},state:{name:"state",values:{refreshTokenFallback:"refreshTokenFallback",continueActivationFlow:"activation",pendingLogout:"logout"}},code:{name:"code",values:void 0},retryFailedLogin:{name:"retryFailedLogin",values:{true:"true"}}},t.repository=new A;var e=i.a.getAuthSettings();if(!t.validateAuthSystemSettings(e))throw a.a.error(t.name,"constructor","Malformed Auth0 client options"),s.a.MALFORMED_AUTH0_OPTIONS;return t.setupAuthOptions(e),t.auth0Client=new o.a(t.auth0Options),t.checkAuthState(),t}return S(t,n),t.prototype.getGsiToken=function(t){var e=null,n="https://naviga.com/GSI";return t.AuthSystemData&&t.AuthSystemData[n]&&(e=t.AuthSystemData[n]),e},t.prototype.HasActiveSession=function(){var n=this;return this._HasActiveSession().then(function(t){return t?n.getAuthProfile().then(function(t){var e=n.getGsiToken(t);if(e)return P.a.tryAuth0EntitlementFlow(e,t.UserId)}).then(function(){return t}).catch(function(){return t}):Promise.resolve(!1)})},t.prototype._HasActiveSession=function(){var n=this,o="HasActiveSession";if(this.repository.getAuth0AccountId())return this.refreshAccountIdCookie().then(function(){return!0});var t=this.auth0Client.isAuthenticated();return a.a.log(this.name,o,t),t.then(function(e){return e?n.setAuth0AccountIdCookie().then(function(){return n.refreshAuthTokenIfNeeded().then(function(t){return e}).catch(function(t){return a.a.error(n.name,o,"token refresh failed, reason: "+JSON.stringify(t)),n.logout(n.buildReturnUrl([{key:n.urlParams.state.name,value:n.urlParams.state.values.refreshTokenFallback}])),!1})}):Promise.resolve(e)})},t.prototype.showLoginForm=function(t){t&&t.preventDefault();var e=this.auth0Options.redirect_uri;e=g.a.getActivationProcess()?Object(u.c)(e,this.urlParams.returnUrl.name,this.buildReturnUrl([{key:this.urlParams.state.name,value:this.urlParams.state.values.continueActivationFlow}])):Object(u.c)(e,this.urlParams.returnUrl.name,this.buildReturnUrl()),a.a.log(this.name,"showLoginForm","Redirect Url: "+e),this.auth0Client.loginWithRedirect({redirect_uri:e})},t.prototype.showRegisterForm=function(t){this.showLoginForm(t)},t.prototype.logout=function(t){void 0===t&&(t=null);var e=this.auth0Options.redirect_uri;e=Object(u.c)(e,this.urlParams.state.name,this.urlParams.state.values.pendingLogout),e=Object(u.c)(e,this.urlParams.returnUrl.name,t||this.buildReturnUrl()),a.a.log(this.name,"logout","Logout Url: ",e),this.repository.deleteAuth0AccountId(),this.auth0Client.logout({returnTo:e,client_id:this.auth0Options.client_id})},t.prototype.getAuthProfile=function(){var e=this;return this.auth0Client.getUser().then(function(t){return e.mapAuthProfile(t)})},t.prototype.afterSuccessLogin=function(){this.redirectBackToArticle()},t.prototype.afterSuccessRegistration=function(){this.afterSuccessLogin()},t.prototype.setupAuthOptions=function(t){this.auth0Options=t,this.auth0Options.cacheLocation="localstorage"},t.prototype.checkAuthState=function(){var o=this,r="checkAuthState";a.a.log(this.name,r),this.pendingAuthentication()?(a.a.log(this.name,r,"Pending complete auth"),this.completeAuthentication().then(function(){a.a.log(o.name,r,"auth completed"),o.successLogin()}).catch(function(t){if(a.a.error(o.name,r,t.message),t.message==o.knownErrMessages.invalidState)if(Object(u.o)(o.urlParams.retryFailedLogin.name))o.redirectBackToArticle();else{var e=o.auth0Options.redirect_uri,n=Object(u.o)(o.urlParams.returnUrl.name);e=Object(u.c)(e,o.urlParams.retryFailedLogin.name,o.urlParams.retryFailedLogin.values.true),e=Object(u.c)(e,o.urlParams.returnUrl.name,n),o.auth0Client.loginWithRedirect({redirect_uri:e})}})):this.pendingLogout()?(a.a.log(this.name,r,"Pending logout"),c.a.subscribe(l.a.Finish,function(){o.redirectBackToArticle()})):this.pendingActivation()&&(a.a.log(this.name,r,"Pending activation"),this.continueActivation())},t.prototype.pendingAuthentication=function(){return Object(u.r)(this.urlParams.code.name)&&Object(u.r)(this.urlParams.state.name)},t.prototype.pendingLogout=function(){return Object(u.r)(this.urlParams.state.name)&&Object(u.o)(this.urlParams.state.name)==this.urlParams.state.values.pendingLogout},t.prototype.pendingActivation=function(){return Object(u.r)(this.urlParams.state.name)&&Object(u.o)(this.urlParams.state.name)==this.urlParams.state.values.continueActivationFlow},t.prototype.refreshAuthTokenIfNeeded=function(){return this.auth0Options.useRefreshTokens?this.auth0Client.getTokenSilently():Promise.resolve(null)},t.prototype.completeAuthentication=function(){return this.auth0Client.handleRedirectCallback()},t.prototype.continueActivation=function(){window.history.replaceState({},document.title,Object(u.t)(window.location.href,[this.urlParams.state.name]));var e=c.a.subscribe(l.a.Finish,function(){e();var t=c.a.subscribe(l.a.ActivationFormShown,function(){t(),document.getElementsByClassName("connext-activate")[0].parentNode.style.setProperty("z-index","100000001","important")});h.a.get(p.a.ActivationInstance).process()})},t.prototype.redirectBackToArticle=function(){var t=Object(u.o)(this.urlParams.returnUrl.name);window.history.replaceState({},document.title,"/"),window.location.href=t},t.prototype.buildReturnUrl=function(t){void 0===t&&(t=null);var e=window.location.href;return t&&t.length&&t.forEach(function(t){e=Object(u.c)(e,t.key,t.value)}),e},t.prototype.validateAuthSystemSettings=function(t){return null!=t&&null!=t.domain&&null!=t.client_id&&null!=t.redirect_uri},t.prototype.mapAuthProfile=function(t){var e=v.a.getAuthProfile()||{},n=t||{};return{UserId:n.sub||this.repository.getAuth0AccountId(),IdType:m.e.Usual,Email:n.email||e.email,FullName:n.name||n.nickname||e.name||e.nickname||"",AuthSystemData:t}},t.prototype.refreshAccountIdCookie=function(){var e=this;return this.auth0Client.isAuthenticated().then(function(t){if(t)return e.setAuth0AccountIdCookie()})},t.prototype.setAuth0AccountIdCookie=function(){var e=this;return this.auth0Client.getUser().then(function(t){t&&e.repository.setAuth0AccountId(t.sub,i.a.get(p.a.UserAuthenticationTime))})},t}(r.a)}}]);